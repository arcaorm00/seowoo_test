<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Insert title here</title>
<script src="https://code.jquery.com/jquery-2.2.1.js"></script>
<script type="text/javascript">
$(function(){
	var code = $("#code").val();
	var round = 0;
	
	$("#addBtn").click(function(){
		$("#insertBtn").attr("disabled", false);
		if (round < 3){
			var tr = $("<tr></tr>");
			var mastercodeTd = $("<td style='width: 100px;' align='center'></td>").html("COM002");
			var detailcodeTd = $("<td style='width: 180px;' align='center'><input type='text' width='100%' id='detailcodeTd"+round+"'/></td>");
			var codenameTd = $("<td style='width: 180px;' align='center'><input type='text' width='100%' id='codenameTd"+round+"'/></td>");
			var useynTd = $("<td style='width: 100px;' align='center'><input type='radio' name='useYnRadio"+round+"' value='Y'/>Y<input type='radio' name='useYnRadio"+round+"' value='N'/>N</td>");
			tr.append(mastercodeTd, detailcodeTd, codenameTd, useynTd);
			$("#codeTable").append(tr);
			round += 1;
		}else{
			alert("한번에 입력할 수 있는 코드는 최대 3개입니다.");
		}
	});
	
	$("#insertBtn").click(function(){
		var list = [];
		
		for(var i = 0; i < round; i++){
			var detailcode = $("#detailcodeTd"+i).val().trim();
			var codename = $("#codenameTd"+i).val().trim();
			var useyn = $("input[name=useYnRadio"+i+"]:checked").val();
			
			// 입력 확인
			if(detailcode == "" && codename == "" && useyn == undefined){
				continue;
			}
			if(detailcode == "" || codename == "" || useyn == undefined){
				alert("입력이 완료되지 않은 행이 있습니다.");
				return;
			}
			
			$.ajax({
				data: {code: code, detailcode: detailcode},
				url: "commonCodeIsExist.ino",
				success: function(re){
					if(re > 0){
						alert("디테일 코드는 중복될 수 없습니다.\n다시 한번 확인해주시기 바랍니다.");
						return;
					}
					
				}
			});
			
			var row = {DECODE: detailcode, DECODE_NAME: codename, USE_YN: useyn};
			list.push(row);
		}
		
		console.log(list);
	});
});
</script>
</head>
<body>
	
	<div>
		<h1>공통코드 등록</h1>
	</div>
	<input type="hidden" id="code" value="${ code }"/>
	<div style="width:650px;" align="right">
		<button id="addBtn" name="addBtn">추가</button>
		<button id="insertBtn" name="insertBtn">등록</button>
	</div>
	<hr style="width: 600px;">
	<div style="padding-bottom: 10px;">
		<table border="1">
			<thead>
				<tr>
					<td style="width: 100px;" align="center">기준 코드</td>
					<td style="width: 180px;" align="center">디테일 코드</td>
					<td style="width: 180px;" align="center">코드 이름</td>
					<td style="width: 100px;" align="center">사용여부</td>
				</tr>
			</thead>
		</table>
	</div>
	<hr style="width: 600px;">

	<div id="boardDiv">
		<table id="codeTable" border="1">
			<tbody>
				<c:forEach var="nRow" items="${ list }">
					<tr>
						<td style="width: 100px;" align="center">${ nRow.CODE }</td>
						<td style="width: 180px;" align="center">${ nRow.DECODE }</td>
						<td style="width: 180px;" align="center">${ nRow.DECODE_NAME }</td>
						<td style="width: 100px;" align="center">${ nRow.USE_YN }</td>
					</tr>
				</c:forEach>
			</tbody>
		</table>
	</div>
</body>
</html>